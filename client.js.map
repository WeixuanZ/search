{"version":3,"sources":["utils.ts","client.ts"],"names":[],"mappings":";AASa,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,YAAA,QAAA,iBAAA,EATb,IAAM,EAAY,SAAC,GACjB,OAAA,mBAAmB,EAAI,QAAQ,OAAQ,SAE5B,EAAc,SAAC,GAC1B,OAAA,EAAM,MAAM,KAAK,OAAO,SAAC,EAAK,GAErB,OADP,EAAI,EAAU,EAAI,MAAM,KAAK,KAAO,EAAU,EAAI,MAAM,KAAK,IACtD,GACN,KAJQ,QAAA,YAAW,EAMjB,IAAM,EAAc,SAAC,GAC1B,OAAA,OAAO,QAAQ,GACZ,IACC,SAAC,GACI,OAAA,mBAAmB,EAAI,IAAG,IAAI,mBAAmB,EAAI,MAE3D,KAAK,MANG,QAAA,YAAW;;ACiExB,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IA1EA,IAAA,EAAA,QAAA,WAEI,EAAS,SAAS,mBACP,IAAX,IACF,EAAS,SAAS,cAChB,qHAKJ,IAAM,EAAgC,OAAO,OAAO,EAAO,YAAY,OACrE,SAAC,EAAK,GAEG,OADP,EAAI,EAAI,KAAK,QAAQ,SAAU,KAAO,EAAI,MACnC,GAET,IAII,EAAgB,SAAS,cAC7B,yBAEF,EAAM,IAAM,EACR,EAAc,KACd,SAAS,OAAS,SAAS,SAAW,SAAS,OACnD,EAAM,OAAS,SAAS,OACxB,EAAM,SACJ,SAAS,SAAS,OAAS,EACvB,QACA,SAAS,SAAS,OAAO,GAAG,QAAQ,SAAU,IAGpD,SAAS,KAAK,mBACZ,aACA,uUAsBF,IAAM,EAAe,EAAO,IAAI,MAC9B,0DACA,GACI,EAAS,EAAY,sBAC3B,EAAO,mBACL,WACA,iFAAiF,EAAG,IAAI,EAAA,YACtF,GACD,qBAEH,IAAM,EAAQ,EAAO,YACf,EAAY,SAAS,cAAc,eACzC,EAAU,MAAM,OAAS,UACzB,EAAU,iBAAiB,QAAS,WAAO,OAAA,EAAM,MAAM,QAAU,UAEjE,EAAO,SAGP,iBAAiB,UAAW,SAAC,GACvB,GAAA,EAAM,SAAW,EAAjB,CAGE,IAAA,EAAO,EAAM,KACf,GAAsB,UAAd,EAAK,OACf,EAAM,MAAM,QAAU","file":"client.js","sourceRoot":"../src","sourcesContent":["const decodeURI = (uri: string): string =>\n  decodeURIComponent(uri.replace(/[+]/g, '%20'))\n\nexport const decodeQuery = (query: string): Record<string, string> =>\n  query.split('&').reduce((acc, val) => {\n    acc[decodeURI(val.split('=')[0])] = decodeURI(val.split('=')[1])\n    return acc\n  }, {})\n\nexport const formatQuery = (obj: Record<string, string>): string =>\n  Object.entries(obj)\n    .map(\n      (val: [string, string]): string =>\n        `${encodeURIComponent(val[0])}=${encodeURIComponent(val[1])}`\n    )\n    .join('&')\n","import { formatQuery } from './utils'\n\nlet script = document.currentScript as HTMLScriptElement\nif (script === undefined) {\n  script = document.querySelector(\n    'script[src^=\"https://weixuanz.github.io/search/client.js\"],script[src^=\"http://localhost:4000/search/client.js\"]'\n  ) as HTMLScriptElement\n}\n\n// gather script element's attributes\nconst attrs: Record<string, string> = Object.values(script.attributes).reduce(\n  (acc, val) => {\n    acc[val.name.replace(/^data-/, '')] = val.value\n    return acc\n  },\n  {}\n)\n\n// gather page attributes\nconst canonicalLink = document.querySelector(\n  'link[rel=\"canonical\"]'\n) as HTMLLinkElement\nattrs.url = canonicalLink\n  ? canonicalLink.href\n  : location.origin + location.pathname + location.search\nattrs.origin = location.origin\nattrs.pathname =\n  location.pathname.length < 2\n    ? 'index'\n    : location.pathname.substr(1).replace(/\\.\\w+$/, '')\n\n// add styles for the injected search iframe\ndocument.head.insertAdjacentHTML(\n  'afterbegin',\n  `<style>\n    #search {\n      position: fixed;\n      top: 0;\n      right: 0;\n      bottom: 0;\n      left: 0;\n      z-index: 9999;\n      display: none;\n    }\n    #search-frame {\n      position: absolute;\n      height: 100%;\n      width: 100%;\n      left: 0;\n      top: 0;\n      border: none;\n    }\n  </style>`\n)\n\n// create the comments iframe and it's responsive container\nconst searchOrigin = script.src.match(\n  /^https:\\/\\/weixuanz\\.github\\.io|http:\\/\\/localhost:\\d+/\n)[0]\nconst url = `${searchOrigin}/search/search.html`\nscript.insertAdjacentHTML(\n  'afterend',\n  `<div id=\"search\"><iframe id=\"search-frame\" title=\"Search\" scrolling=\"no\" src=\"${url}?${formatQuery(\n    attrs\n  )}\"></iframe></div>`\n)\nconst frame = script.nextSibling as HTMLIFrameElement\nconst searchBtn = document.querySelector('#search-btn') as HTMLDivElement\nsearchBtn.style.cursor = 'pointer'\nsearchBtn.addEventListener('click', () => (frame.style.display = 'block'))\n\nscript.remove() // remove the original script tag\n\n// listen to message for hiding the search iframe\naddEventListener('message', (event) => {\n  if (event.origin !== searchOrigin) {\n    return\n  }\n  const data = event.data\n  if (data && data.type === 'close') {\n    frame.style.display = 'none'\n  }\n})\n"]}